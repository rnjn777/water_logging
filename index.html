<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Urban Flood Risk Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: #f3f4f6;
}

/* HEADER */
header {
  background: linear-gradient(135deg, #111827, #1f2937);
  color: white;
  padding: 10px 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

header h1 {
  font-size: 16px;
  margin: 0;
}

/* HEADER BUTTON */
header button {
  background: #dc2626;
  border: none;
  color: white;
  padding: 6px 12px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  font-size: 12px;
}

/* CONTROLS */
.controls {
  background: white;
  padding: 8px 10px;
  display: flex;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid #ddd;
}

.controls label {
  font-size: 13px;
}

select, button {
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-weight: 600;
  font-size: 13px;
}

/* MAP */
#map {
  flex: 1;
}

/* LEGEND */
#legend {
  position: absolute;
  bottom: 14px;
  right: 14px;
  background: white;
  padding: 10px;
  border-radius: 10px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.25);
  font-size: 12px;
  z-index: 1000;
}

.legend-item {
  display: flex;
  align-items: center;
  margin: 4px 0;
}

.box {
  width: 12px;
  height: 12px;
  margin-right: 6px;
  border-radius: 4px;
}

/* MODAL */
#modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  z-index: 2000;
}

#modalContent {
  background: white;
  width: 90%;
  max-width: 420px;
  max-height: 70vh;
  overflow-y: auto;
  margin: 10vh auto;
  padding: 14px;
  border-radius: 12px;
}

.location-item {
  padding: 10px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  font-size: 14px;
}

.location-item:hover {
  background: #f3f4f6;
}

/* üåßÔ∏è ANIMATION */
.leaflet-interactive {
  transition: fill 0.6s ease, stroke 0.6s ease, r 0.6s ease;
}

/* üì± MOBILE OPTIMIZATION */
@media (max-width: 600px) {

  header h1 {
    font-size: 14px;
  }

  .controls {
    flex-wrap: wrap;
    gap: 6px;
  }

  #legend {
    bottom: 10px;
    right: 10px;
    font-size: 11px;
  }
}
</style>
</head>

<body>

<header>
  <h1>üåß Flood Risk Dashboard</h1>
  <button onclick="openModal()">‚ö†Ô∏è Critical Areas</button>
</header>

<div class="controls">
  <label>Rain:</label>
  <select onchange="setRain(this.value)">
    <option value="Light">üå§ Light</option>
    <option value="Moderate">üåß Moderate</option>
    <option value="Heavy">‚õà Heavy</option>
  </select>

  <button onclick="enableReportMode()">‚ûï Report</button>
</div>

<div id="map"></div>

<!-- LEGEND -->
<div id="legend">
  <div class="legend-item"><span class="box low"></span> Low</div>
  <div class="legend-item"><span class="box medium"></span> Medium</div>
  <div class="legend-item"><span class="box high"></span> High</div>
</div>

<!-- MODAL -->
<div id="modal" onclick="closeModal(event)">
  <div id="modalContent">
    <h3>‚ö†Ô∏è Critical Locations</h3>
    <div id="locationList"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let rainLevel = "Light";
let geojsonLayer;
let reportMode = false;
let priorityLocations = [];

const delhiBounds = L.latLngBounds(
  [28.40, 76.80],
  [28.95, 77.40]
);

const map = L.map("map", {
  maxBounds: delhiBounds,
  maxBoundsViscosity: 1.0,
  minZoom: 10,
  maxZoom: 16
}).setView([28.6139, 77.2090], 11);

L.tileLayer(
  "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
  { attribution: "¬© OpenStreetMap ¬© CARTO" }
).addTo(map);

function getColor(risk) {
  if (rainLevel === "Heavy") return "#dc2626";
  if (rainLevel === "Moderate") {
    if (risk !== "Low") return "#dc2626";
    return "#f97316";
  }
  if (risk === "High") return "#dc2626";
  if (risk === "Medium") return "#f97316";
  return "#fde68a";
}

function getRadius() {
  return rainLevel === "Heavy" ? 9 :
         rainLevel === "Moderate" ? 8 : 7;
}

fetch("data.geojson")
  .then(res => res.json())
  .then(data => {

    priorityLocations = data.features.filter(f => f.properties.Risk === "High");

    const list = document.getElementById("locationList");
    priorityLocations.forEach((f, i) => {
      const div = document.createElement("div");
      div.className = "location-item";
      div.textContent = `${i + 1}. ${f.properties.Location_Road}`;
      div.onclick = () => focusOnLocation(i);
      list.appendChild(div);
    });

    geojsonLayer = L.geoJSON(data, {
      pointToLayer: (f, latlng) =>
        L.circleMarker(latlng, {
          radius: getRadius(),
          fillColor: getColor(f.properties.Risk),
          fillOpacity: 0.9,
          color: "#374151",
          weight: 0.5
        }),
      onEachFeature: (f, layer) => {
        layer.bindPopup(
          `<b>${f.properties.Location_Road}</b><br>${f.properties.Risk} Risk`
        );
      }
    }).addTo(map);

    updateLegend();
  });

function setRain(level) {
  rainLevel = level;
  geojsonLayer.setStyle(f => ({
    fillColor: getColor(f.properties.Risk),
    radius: getRadius()
  }));
  updateLegend();
}

function updateLegend() {
  document.querySelector(".low").style.background =
    rainLevel === "Heavy" ? "#dc2626" :
    rainLevel === "Moderate" ? "#f97316" : "#fde68a";

  document.querySelector(".medium").style.background =
    rainLevel === "Light" ? "#f97316" : "#dc2626";

  document.querySelector(".high").style.background = "#dc2626";
}

function focusOnLocation(index) {
  closeModal();
  const f = priorityLocations[index];
  const [lng, lat] = f.geometry.coordinates;
  map.setView([lat, lng], 15);

  L.circleMarker([lat, lng], {
    radius: 14,
    fillColor: "#dc2626",
    fillOpacity: 0.9,
    color: "#000",
    weight: 2
  }).addTo(map)
    .bindPopup(`üö® <b>${f.properties.Location_Road}</b><br>Immediate Attention`)
    .openPopup();
}

function openModal() {
  document.getElementById("modal").style.display = "block";
}

function closeModal(e) {
  if (e && e.target.id !== "modal") return;
  document.getElementById("modal").style.display = "none";
}

function enableReportMode() {
  reportMode = true;
  alert("Tap on map to report waterlogging");
}
</script>

</body>
</html>
